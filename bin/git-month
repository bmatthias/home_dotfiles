#!/usr/bin/env bash

month=${1:-$(date +%m)}
before=$(date --date="$(date +%Y-$(date --date="$(date +%Y-$month-15) +1month" +%m)-1)" +%F)
after=$(date --date="$(date +%Y-$month-1) -1day" +%F)
params=( --after=$after )
if (( $( date -d $before +%s ) < $( date +%s ) ))
then params+=( --before=$before )
fi

echo "#Timeline: $after - $before"

cd ~/projects

for r in */*
do
  data="$(
    builtin cd $r;
    [[ -d .git ]] &&
      git log --pretty=format:"%ci %ce %s" "${params[@]}" --no-merges | grep -i papis | sort
  )"
  [[ -n "$data" ]] && printf -- "--- $r:\n$data\n"
done

echo "#Timeline: $after - $before"
